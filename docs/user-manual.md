# VSCode 逻辑分析器插件 - 用户手册

## 📖 目录

1. [插件概述](#插件概述)
2. [安装与配置](#安装与配置)
3. [设备连接](#设备连接)
4. [数据采集](#数据采集)
5. [波形分析](#波形分析)
6. [协议解码](#协议解码)
7. [数据导出](#数据导出)
8. [高级功能](#高级功能)
9. [故障排除](#故障排除)
10. [常见问题](#常见问题)

## 插件概述

VSCode 逻辑分析器插件是一个专业的硬件调试工具，支持多种逻辑分析器设备，提供实时数据采集、波形显示和协议解码功能。

### 主要特性

- **多硬件支持**: 兼容 Saleae Logic、Kingst LA、Pico Logic 等设备
- **实时采集**: 高速数据捕获，最高支持 100MHz 采样率
- **协议解码**: 内置 I2C、SPI、UART 等常用协议解码器
- **跨平台**: 支持 Windows、macOS、Linux
- **中文界面**: 完整的中文本地化支持

## 安装与配置

### 系统要求

- **VSCode**: 1.60.0 或更高版本
- **Node.js**: 16.0.0 或更高版本
- **操作系统**: Windows 10+、macOS 10.15+、Linux (Ubuntu 18.04+)
- **内存**: 至少 4GB RAM
- **USB**: 可用的 USB 2.0 或 3.0 端口

### 安装步骤

#### 方法一：VSCode 扩展市场安装

1. 打开 VSCode
2. 点击左侧活动栏的扩展图标 (Ctrl+Shift+X)
3. 在搜索框输入 "Logic Analyzer"
4. 找到 "VSCode Logic Analyzer" 插件
5. 点击 "安装" 按钮

#### 方法二：离线安装

1. 从 [发布页面](https://github.com/your-repo/vscode-logicanalyzer/releases) 下载最新的 .vsix 文件
2. 在 VSCode 中按 Ctrl+Shift+P 打开命令面板
3. 输入 "Extensions: Install from VSIX"
4. 选择下载的 .vsix 文件

### 初始配置

安装完成后，插件会自动进行初始配置：

1. **权限设置**: 在 Linux/macOS 上可能需要设置串口访问权限
2. **驱动检测**: 自动检测已连接的逻辑分析器设备
3. **默认配置**: 创建默认的配置文件

#### Linux 权限配置

```bash
# 将用户添加到 dialout 组
sudo usermod -a -G dialout $USER

# 重新登录使权限生效
# 或者直接设置设备权限
sudo chmod 666 /dev/ttyUSB*
```

#### macOS 权限配置

```bash
# 安装必要的驱动程序
brew install libusb

# 某些设备可能需要额外的驱动
# 请参考设备制造商的说明
```

## 设备连接

### 支持的设备

| 设备型号 | 制造商 | 通道数 | 最大频率 | 连接方式 |
|----------|--------|--------|----------|----------|
| Logic 8 | Saleae | 8 | 100MHz | USB 3.0 |
| Logic Pro 16 | Saleae | 16 | 500MHz | USB 3.0 |
| LA1010 | Kingst | 16 | 200MHz | USB 2.0 |
| Pico Logic | Custom | 24 | 100MHz | USB 2.0 |

### 连接步骤

1. **物理连接**
   - 使用 USB 线将逻辑分析器连接到计算机
   - 确保 USB 线支持数据传输（不是仅供电线）
   - 推荐使用 USB 3.0 端口以获得更好性能

2. **设备识别**
   - 打开 VSCode
   - 按 Ctrl+Shift+P 打开命令面板
   - 输入 "Logic Analyzer: Refresh Devices"
   - 等待设备扫描完成

3. **选择设备**
   - 在设备列表中选择您的逻辑分析器
   - 点击 "连接" 按钮
   - 等待连接成功提示

### 连接状态指示

- 🟢 **已连接**: 设备正常工作，准备采集
- 🟡 **连接中**: 正在建立连接
- 🔴 **未连接**: 设备未连接或连接失败
- ⚪ **未知**: 设备状态未知，需要刷新

## 数据采集

### 采集参数配置

#### 采样频率设置

采样频率决定了数据采集的精度和速度：

- **低频信号 (< 1kHz)**: 使用 10kHz - 100kHz
- **中频信号 (1kHz - 100kHz)**: 使用 1MHz - 10MHz
- **高频信号 (> 100kHz)**: 使用 10MHz - 100MHz

**注意**: 根据奈奎斯特定理，采样频率应至少是被测信号最高频率的2倍。

#### 通道配置

1. **选择通道**
   - 在通道列表中勾选需要采集的通道
   - 为每个通道设置有意义的名称
   - 设置适当的电压阈值（通常为 1.8V 或 3.3V）

2. **通道标签**
   ```
   CH0: SDA (I2C数据线)
   CH1: SCL (I2C时钟线)
   CH2: MOSI (SPI主输出)
   CH3: MISO (SPI主输入)
   CH4: CLK (SPI时钟)
   CH5: CS (SPI片选)
   ```

#### 触发设置

触发器用于在特定条件下开始数据采集：

1. **边沿触发**
   - 上升沿: 信号从低电平变为高电平
   - 下降沿: 信号从高电平变为低电平
   - 双边沿: 任何电平变化

2. **电平触发**
   - 高电平: 信号保持高电平时触发
   - 低电平: 信号保持低电平时触发

3. **复合触发**
   - 多个通道的组合条件
   - 支持 AND、OR 逻辑运算

#### 缓冲区配置

- **预触发样本数**: 触发前保存的数据量
- **后触发样本数**: 触发后采集的数据量
- **总缓冲区大小**: 设备内存限制

### 开始采集

1. **配置完成检查**
   - 确认采样频率设置合理
   - 确认通道选择正确
   - 确认触发条件设置

2. **启动采集**
   - 点击 "开始采集" 按钮
   - 或使用快捷键 F5
   - 等待触发条件满足

3. **监控采集状态**
   - 查看采集进度条
   - 监控数据传输速率
   - 观察缓冲区使用情况

### 停止采集

- **自动停止**: 达到设定的采样数量时自动停止
- **手动停止**: 点击 "停止采集" 按钮或按 F6
- **错误停止**: 发生错误时自动停止并显示错误信息

## 波形分析

### 波形显示界面

主要组件：
- **时间轴**: 显示时间刻度和总采集时间
- **通道列表**: 显示所有采集通道和状态
- **波形区域**: 显示数字信号波形
- **标尺工具**: 用于测量时间间隔和频率

### 导航操作

#### 缩放控制

- **水平缩放**: 
  - 鼠标滚轮向上: 放大时间轴
  - 鼠标滚轮向下: 缩小时间轴
  - 快捷键: Ctrl + '+'/''-'

- **垂直缩放**:
  - Shift + 鼠标滚轮: 调整通道高度
  - 双击通道名称: 自动调整高度

#### 平移操作

- **拖拽**: 按住左键拖拽波形
- **键盘**: 使用方向键精确移动
- **滚动条**: 使用底部滚动条快速跳转

### 测量工具

#### 时间测量

1. **标尺工具**
   - 点击标尺按钮激活
   - 在波形上点击设置起始点
   - 拖拽到结束点查看时间差
   - 显示频率信息（对于周期信号）

2. **游标测量**
   - 设置两个游标
   - 显示时间差和频率
   - 支持精确的数值输入

#### 数字测量

- **高电平时间**: 信号保持高电平的持续时间
- **低电平时间**: 信号保持低电平的持续时间
- **占空比**: 高电平时间占整个周期的百分比
- **频率分析**: 对周期信号进行频率统计

### 搜索功能

#### 模式搜索

搜索特定的数字模式：

1. **二进制模式**: 例如 "10110101"
2. **十六进制模式**: 例如 "0xB5"
3. **ASCII模式**: 搜索字符串对应的二进制模式

#### 边沿搜索

- **上升沿搜索**: 找到指定通道的所有上升沿
- **下降沿搜索**: 找到指定通道的所有下降沿
- **跳转功能**: 快速跳转到搜索结果

## 协议解码

### 内置解码器

#### I2C 协议解码

I2C（Inter-Integrated Circuit）是常用的串行通信协议。

**配置参数**:
- **SCL通道**: 时钟线通道号
- **SDA通道**: 数据线通道号
- **地址位数**: 7位或10位地址

**解码输出**:
```
开始条件 -> 地址: 0x48 (写) -> ACK -> 数据: 0x12 -> ACK -> 停止条件
开始条件 -> 地址: 0x48 (读) -> ACK -> 数据: 0x34 -> NACK -> 停止条件
```

**使用步骤**:
1. 选择 I2C 解码器
2. 配置 SCL 和 SDA 通道
3. 点击 "开始解码"
4. 查看解码结果

#### SPI 协议解码

SPI（Serial Peripheral Interface）是全双工同步串行协议。

**配置参数**:
- **CLK通道**: 时钟信号
- **MOSI通道**: 主设备输出，从设备输入
- **MISO通道**: 主设备输入，从设备输出
- **CS通道**: 片选信号（可选）
- **时钟极性**: CPOL (0或1)
- **时钟相位**: CPHA (0或1)
- **位序**: MSB优先或LSB优先

**解码输出**:
```
CS下降 -> MOSI: 0x53 MISO: 0x00 -> MOSI: 0x12 MISO: 0x34 -> CS上升
```

#### UART 协议解码

UART（Universal Asynchronous Receiver-Transmitter）异步串行通信。

**配置参数**:
- **RX通道**: 接收数据线
- **TX通道**: 发送数据线（可选）
- **波特率**: 9600, 115200 等
- **数据位**: 5-8位
- **停止位**: 1, 1.5, 2位
- **奇偶校验**: 无、奇校验、偶校验

**解码输出**:
```
RX: 'H' (0x48) -> 'e' (0x65) -> 'l' (0x6C) -> 'l' (0x6C) -> 'o' (0x6F)
TX: 'O' (0x4F) -> 'K' (0x4B) -> '\r' (0x0D) -> '\n' (0x0A)
```

### 自定义解码器

#### 创建解码器

1. **新建解码器文件**
   - 在 `decoders/custom/` 目录创建 `.ts` 文件
   - 继承 `DecoderBase` 基类

2. **实现解码逻辑**
   ```typescript
   class MyCustomDecoder extends DecoderBase {
     readonly id = 'my-protocol';
     readonly name = '我的协议';
     readonly channels = [
       { id: 'data', name: '数据线', description: '数据信号线' },
       { id: 'clock', name: '时钟线', description: '时钟信号线' }
     ];

     decode(sampleRate: number, channels: AnalyzerChannel[]): DecoderResult[] {
       const results: DecoderResult[] = [];
       
       // 实现解码逻辑
       // ...
       
       return results;
     }
   }
   ```

3. **注册解码器**
   - 在解码器管理器中注册新解码器
   - 添加到解码器列表

#### 解码器开发指南

详细的解码器开发教程请参考 [解码器开发指南](decoder-development.md)。

## 数据导出

### 支持的导出格式

#### LAC 格式
- **文件扩展名**: .lac
- **特点**: 项目原生格式，保留所有采集信息
- **用途**: 保存完整的采集会话，支持重新加载

#### CSV 格式
- **文件扩展名**: .csv
- **特点**: 文本格式，易于在Excel等软件中查看
- **内容**: 时间戳和各通道的数字状态
- **示例**:
  ```csv
  Time(us),CH0,CH1,CH2,CH3
  0.000,0,0,1,1
  0.100,0,1,1,1
  0.200,1,1,0,1
  ```

#### VCD 格式
- **文件扩展名**: .vcd (Value Change Dump)
- **特点**: 标准的波形数据格式
- **用途**: 在其他 EDA 工具中查看波形

#### PNG/SVG 图像
- **格式**: PNG位图或SVG矢量图
- **用途**: 文档和报告中使用
- **配置**: 可设置分辨率、时间范围、通道选择

### 导出步骤

1. **选择导出范围**
   - 全部数据: 导出所有采集的数据
   - 当前视图: 仅导出当前显示的时间范围
   - 自定义范围: 手动设置起始和结束时间

2. **选择导出通道**
   - 全部通道: 导出所有通道数据
   - 活动通道: 仅导出当前显示的通道
   - 自定义选择: 手动选择要导出的通道

3. **配置导出选项**
   - 文件名和路径
   - 数据格式选项
   - 压缩设置（如果支持）

4. **执行导出**
   - 点击 "导出" 按钮
   - 等待导出完成
   - 查看导出结果

## 高级功能

### 数学运算

#### 逻辑运算
- **AND**: 两个或多个通道的逻辑与运算
- **OR**: 两个或多个通道的逻辑或运算
- **XOR**: 两个通道的逻辑异或运算
- **NOT**: 单个通道的逻辑非运算

#### 时序分析
- **建立时间检查**: 验证数据相对于时钟的建立时间
- **保持时间检查**: 验证数据相对于时钟的保持时间
- **时钟抖动分析**: 分析时钟信号的稳定性

### 脚本自动化

#### 脚本语言支持
支持 JavaScript/TypeScript 脚本自动化：

```javascript
// 自动采集脚本示例
const session = new CaptureSession();
session.frequency = 1000000;
session.channels = [0, 1, 2, 3];

// 开始采集
await driver.startCapture(session);

// 等待完成
await driver.waitForComplete();

// 运行解码器
const results = await decoder.decode('i2c', session.data);

// 导出结果
await exporter.saveToFile(results, 'output.csv');
```

#### 批处理功能
- **批量文件处理**: 处理多个采集文件
- **自动报告生成**: 生成标准化的分析报告
- **定时任务**: 设置定期执行的分析任务

### 性能优化

#### 大数据处理
- **流式处理**: 对于大量数据使用流式处理
- **内存优化**: 智能内存管理，避免内存泄漏
- **多线程**: 利用多核CPU加速处理

#### 显示优化
- **LOD渲染**: 根据缩放级别调整显示细节
- **硬件加速**: 使用GPU加速波形渲染
- **懒加载**: 按需加载波形数据

## 故障排除

### 常见连接问题

#### 设备无法识别

**症状**: 插入设备后在设备列表中看不到

**可能原因**:
1. USB线缆问题（仅供电线）
2. 驱动程序未安装
3. 设备权限问题
4. 设备硬件故障

**解决方案**:
1. 更换USB数据线
2. 安装设备制造商提供的驱动程序
3. 检查设备管理器中的设备状态
4. 尝试不同的USB端口

#### 连接超时

**症状**: 设备显示在列表中但连接失败

**解决方案**:
1. 重启VSCode
2. 重新插拔设备
3. 检查其他软件是否占用设备
4. 降低采样频率重试

### 采集问题

#### 采集无数据

**可能原因**:
1. 触发条件未满足
2. 信号线连接错误
3. 电压阈值设置不当
4. 采样频率过低

**解决方案**:
1. 使用"强制触发"或"无触发"模式
2. 检查信号线连接
3. 调整电压阈值到合适值
4. 提高采样频率

#### 数据丢失

**症状**: 采集的数据不完整或有间断

**解决方案**:
1. 降低采样频率
2. 减少同时采集的通道数
3. 使用USB 3.0端口
4. 关闭其他占用系统资源的程序

### 解码问题

#### 解码结果错误

**可能原因**:
1. 通道配置错误
2. 协议参数设置不正确
3. 采样率过低
4. 信号质量问题

**解决方案**:
1. 检查通道分配是否正确
2. 确认协议参数（波特率、时钟极性等）
3. 提高采样频率
4. 检查信号完整性

#### 解码器崩溃

**解决方案**:
1. 重启解码器
2. 减少解码数据量
3. 检查输入数据格式
4. 更新解码器版本

### 性能问题

#### 界面卡顿

**解决方案**:
1. 减少显示的时间范围
2. 降低波形显示密度
3. 关闭不必要的通道显示
4. 增加系统内存

#### 内存不足

**解决方案**:
1. 减少采集样本数
2. 定期清理历史数据
3. 使用64位版本的VSCode
4. 升级系统内存

## 常见问题

### Q: 支持哪些操作系统？
A: 支持Windows 10+、macOS 10.15+、Ubuntu 18.04+等主流操作系统。

### Q: 最大采样频率是多少？
A: 取决于具体硬件，一般支持100MHz，部分高端设备可达500MHz。

### Q: 可以同时连接多个设备吗？
A: 是的，支持同时连接最多5个逻辑分析器设备。

### Q: 支持模拟信号采集吗？
A: 当前版本仅支持数字信号，模拟信号支持在开发计划中。

### Q: 如何添加自定义协议解码器？
A: 请参考[解码器开发指南](decoder-development.md)。

### Q: 数据文件可以在其他软件中打开吗？
A: LAC格式是专用格式，但可以导出为CSV、VCD等通用格式。

### Q: 插件是开源的吗？
A: 是的，项目采用MIT开源许可证。

### Q: 如何报告bug或请求功能？
A: 请在GitHub仓库的Issues页面提交问题或建议。

---

**需要更多帮助？**

- 📚 查看完整的[API文档](api-reference.md)
- 👨‍💻 阅读[开发者指南](developer-guide.md)
- 💬 访问[社区论坛](https://github.com/your-repo/vscode-logicanalyzer/discussions)
- 📧 联系技术支持: support@logicanalyzer-vscode.com