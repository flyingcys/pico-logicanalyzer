# Pico Logic Analyzer æµ‹è¯•å®Œæ•´æŒ‡å—

**æœ€æ–°æ›´æ–°**: 2025-01-12  
**çŠ¶æ€**: ğŸŸ¢ å·²ä¼˜åŒ– - æµ‹è¯•ç¯å¢ƒå·²å¤§å¹…æ”¹å–„  
**ç‰ˆæœ¬**: v2.0 (ä¼˜åŒ–ç‰ˆæœ¬)

---

## ğŸ“‹ å¿«é€Ÿå¯¼èˆª

| ç« èŠ‚ | å†…å®¹ | é€‚ç”¨åœºæ™¯ |
|------|------|----------|
| [ğŸš¨ ç´§æ€¥ä¿®å¤](#-ç´§æ€¥ä¿®å¤) | ç«‹å³å¯æ‰§è¡Œçš„ä¿®å¤æ–¹æ¡ˆ | æµ‹è¯•æ— æ³•è¿è¡Œæ—¶ |
| [ğŸ“Š ç°çŠ¶åˆ†æ](#-ç°çŠ¶åˆ†æ) | åŸºäºå®é™…æ•°æ®çš„å®Œæ•´è¯„ä¼° | äº†è§£é¡¹ç›®çŠ¶å†µ |
| [ğŸ› ï¸ ä¿®å¤è®¡åˆ’](#ï¸-ä¿®å¤è®¡åˆ’) | è¯¦ç»†çš„åˆ†é˜¶æ®µæ‰§è¡Œè®¡åˆ’ | åˆ¶å®šå·¥ä½œå®‰æ’ |
| [ğŸ“ˆ æå‡ç­–ç•¥](#-æå‡ç­–ç•¥) | è¦†ç›–ç‡å’Œè´¨é‡æå‡æ–¹æ³• | é•¿æœŸæ”¹è¿›å·¥ä½œ |
| [ğŸ”§ å®ç”¨å·¥å…·](#-å®ç”¨å·¥å…·) | è„šæœ¬å’Œå‘½ä»¤è¡Œå·¥å…· | æ—¥å¸¸å¼€å‘ä½¿ç”¨ |

---

## ğŸš¨ ç´§æ€¥ä¿®å¤

### âš¡ 5åˆ†é’Ÿå¿«é€Ÿä¿®å¤

å¦‚æœæ‰€æœ‰æµ‹è¯•éƒ½æ— æ³•è¿è¡Œï¼Œç«‹å³æ‰§è¡Œï¼š

```bash
# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd /home/share/samba/vscode-extension/pico-logicanalyzer

# 2. è¿è¡Œå¿«é€Ÿä¿®å¤è„šæœ¬
./docs/utest/quick-fix-script.sh

# 3. éªŒè¯ä¿®å¤æ•ˆæœ
npm test -- --testTimeout=10000 --maxWorkers=1 --passWithNoTests
```

### ğŸ” é—®é¢˜è¯Šæ–­

å¦‚æœå¿«é€Ÿä¿®å¤å¤±è´¥ï¼ŒæŒ‰ä»¥ä¸‹é¡ºåºæ’æŸ¥ï¼š

1. **æ£€æŸ¥ TypeScript ç¼–è¯‘**
   ```bash
   npx tsc --noEmit --project tsconfig.json
   ```

2. **æ£€æŸ¥ Jest é…ç½®**
   ```bash
   npx jest --showConfig
   ```

3. **æ£€æŸ¥æµ‹è¯•æ–‡ä»¶è¯­æ³•**
   ```bash
   npx jest --listTests
   ```

### ğŸ› ï¸ æ‰‹åŠ¨ä¿®å¤æ–¹æ¡ˆ

å¦‚æœè‡ªåŠ¨ä¿®å¤ä¸æˆåŠŸï¼Œæ‰‹åŠ¨ä¿®å¤ `utest/setup.ts` çš„å…³é”®é—®é¢˜ï¼š

```typescript
// ä¿®å¤ localStorage Mock
global.localStorage = {
  getItem: jest.fn(),
  setItem: jest.fn(),
  removeItem: jest.fn(),
  clear: jest.fn(),
  length: 0,  // âœ… æ·»åŠ ç¼ºå¤±å±æ€§
  key: jest.fn().mockReturnValue(null)  // âœ… æ·»åŠ ç¼ºå¤±æ–¹æ³•
} as Storage;

// ä¿®å¤ KeyboardEvent Mock
global.KeyboardEvent = class MockKeyboardEvent extends Event {
  static readonly DOM_KEY_LOCATION_STANDARD = 0;
  static readonly DOM_KEY_LOCATION_LEFT = 1;
  static readonly DOM_KEY_LOCATION_RIGHT = 2;
  static readonly DOM_KEY_LOCATION_NUMPAD = 3;
  // ... å®Œæ•´å®ç°
} as any;
```

---

## ğŸ“Š ç°çŠ¶åˆ†æ

### ğŸ“ˆ å…³é”®æŒ‡æ ‡ (2025-01-12 ä¼˜åŒ–å)

| æŒ‡æ ‡ | æ•°å€¼ | è¯„ä¼° |
|------|------|------|
| **æµ‹è¯•æ–‡ä»¶æ€»æ•°** | 228ä¸ª | âœ… å……è¶³ |
| **æºä»£ç æ–‡ä»¶æ•°** | 91ä¸ª | - |
| **æµ‹è¯•/ä»£ç æ¯”ä¾‹** | 2.5:1 | âœ… ä¼˜ç§€ |
| **å½“å‰è¦†ç›–ç‡** | å¯æ­£å¸¸æ”¶é›† | âœ… æŠ€æœ¯é—®é¢˜å·²ä¿®å¤ |
| **å¤±è´¥æµ‹è¯•å¥—ä»¶** | éƒ¨åˆ†ä»æœ‰é”™è¯¯ | ğŸŸ¡ æŒç»­æ”¹è¿›ä¸­ |

### ğŸ—ï¸ æ¶æ„è¯„ä¼°

| ç»´åº¦ | çŠ¶æ€ | è¯„åˆ† | è¯´æ˜ |
|------|------|------|------|
| **ç›®å½•ç»“æ„** | ğŸŸ¢ ä¼˜ç§€ | 9/10 | åˆ†ç±»æ¸…æ™°ï¼Œè¦†ç›–å…¨é¢ |
| **æŠ€æœ¯æ ˆé€‰æ‹©** | ğŸŸ¢ åˆé€‚ | 8/10 | Jest + TypeScript + Vue Test Utils |
| **Mock ç³»ç»Ÿ** | ğŸŸ¢ å·²å®Œå–„ | 8/10 | ç±»å‹é”™è¯¯å·²ä¿®å¤ï¼ŒåŠŸèƒ½å®Œæ•´ |
| **é…ç½®è´¨é‡** | ğŸŸ¢ ä¼˜ç§€ | 8/10 | å¤šç¯å¢ƒæ”¯æŒï¼Œé…ç½®è§„èŒƒ |

### ğŸ“‚ æ¨¡å—è¦†ç›–åˆ†æ

åŸºäºæµ‹è¯•æ–‡ä»¶æ•°é‡çš„æ¨¡å—è¯„ä¼°ï¼š

| æ¨¡å— | æµ‹è¯•æ–‡ä»¶æ•° | å¤æ‚åº¦ | é¢„æœŸè¦†ç›–ç‡ | ä¼˜å…ˆçº§ |
|------|------------|--------|------------|--------|
| **webview** | 80 | é«˜ (å‰ç«¯) | 55-70% | ğŸŸ¡ ä¸­ |
| **drivers** | 36 | é«˜ (ç¡¬ä»¶) | 65-80% | ğŸ”´ é«˜ |
| **services** | 25 | ä¸­ (ä¸šåŠ¡) | 70-85% | ğŸ”´ é«˜ |
| **models** | 18 | ä½ (æ•°æ®) | 75-90% | ğŸ”´ é«˜ |
| **decoders** | 16 | é«˜ (ç®—æ³•) | 60-75% | ğŸŸ¡ ä¸­ |
| **driver-sdk** | 12 | ä¸­ (æ¥å£) | 70-85% | ğŸŸ¡ ä¸­ |
| **utils** | 9 | ä½ (å·¥å…·) | 85-95% | ğŸŸ¢ ä½ |
| **extension** | 5 | ä¸­ (é›†æˆ) | 60-75% | ğŸŸ¢ ä½ |
| **tools** | 4 | ä½ (å¼€å‘) | 80-95% | ğŸŸ¢ ä½ |
| **database** | 3 | ä½ (å­˜å‚¨) | 90-98% | ğŸŸ¢ ä½ |

**æ€»ä½“é¢„æœŸ**: ä¿®å¤å 65-80%ï¼Œä¼˜åŒ–å 80-90%

---

## ğŸ› ï¸ ä¿®å¤è®¡åˆ’

### é˜¶æ®µä¸€: ç´§æ€¥ä¿®å¤ (1-2å¤©)

#### Day 1: è§£å†³é˜»å¡é—®é¢˜
- **ä¸Šåˆ** (2-3å°æ—¶): ä¿®å¤ `utest/setup.ts` ç±»å‹é”™è¯¯
- **ä¸‹åˆ** (3-4å°æ—¶): ä¿®å¤æºä»£ç  TypeScript é”™è¯¯
- **éªŒæ”¶æ ‡å‡†**: è‡³å°‘50%çš„æµ‹è¯•å¯ä»¥è¿è¡Œ

#### Day 2: é…ç½®ä¼˜åŒ–
- **ä¸Šåˆ** (3-4å°æ—¶): ä¼˜åŒ– Jest é…ç½®ï¼ˆå¤šç¯å¢ƒæ”¯æŒï¼‰
- **ä¸‹åˆ** (2-3å°æ—¶): å®Œå–„ Mock å¯¹è±¡åº“
- **éªŒæ”¶æ ‡å‡†**: è¦†ç›–ç‡æ”¶é›†æ­£å¸¸ï¼Œè¾¾åˆ°30-40%

### é˜¶æ®µäºŒ: è¦†ç›–ç‡æå‡ (1-2å‘¨)

#### Week 1: æ ¸å¿ƒæ¨¡å— (ç›®æ ‡: 60%+æ€»ä½“è¦†ç›–ç‡)

**ä¼˜å…ˆçº§1: ç®€å•æ¨¡å—** (Day 3-4)
- database (3ä¸ªæ–‡ä»¶) â†’ ç›®æ ‡90%+
- utils (9ä¸ªæ–‡ä»¶) â†’ ç›®æ ‡85%+  
- tools (4ä¸ªæ–‡ä»¶) â†’ ç›®æ ‡80%+

**ä¼˜å…ˆçº§2: ä¸šåŠ¡æ¨¡å—** (Day 5-7)
- models (18ä¸ªæ–‡ä»¶) â†’ ç›®æ ‡75%+
- services (25ä¸ªæ–‡ä»¶) â†’ ç›®æ ‡70%+

#### Week 2: å¤æ‚æ¨¡å— (ç›®æ ‡: 75%+æ€»ä½“è¦†ç›–ç‡)

**ä¼˜å…ˆçº§3: ç¡¬ä»¶äº¤äº’** (Day 8-10)
- drivers (36ä¸ªæ–‡ä»¶) â†’ ç›®æ ‡65%+
- driver-sdk (12ä¸ªæ–‡ä»¶) â†’ ç›®æ ‡70%+

**ä¼˜å…ˆçº§4: ç®—æ³•è§£ç ** (Day 11-14)
- decoders (16ä¸ªæ–‡ä»¶) â†’ ç›®æ ‡60%+
- webview (80ä¸ªæ–‡ä»¶) â†’ ç›®æ ‡55%+

### é˜¶æ®µä¸‰: è´¨é‡ä¿éšœ (1å‘¨)

#### Week 3: æ·±åº¦ä¼˜åŒ– (ç›®æ ‡: 85%+æ€»ä½“è¦†ç›–ç‡)
- è¾¹ç•Œæ¡ä»¶å’Œå¼‚å¸¸å¤„ç†æµ‹è¯•
- é›†æˆæµ‹è¯•å®Œå–„
- æ€§èƒ½æµ‹è¯•å»ºç«‹
- CI/CD è‡ªåŠ¨åŒ–é…ç½®

---

## ğŸ“ˆ æå‡ç­–ç•¥

### ğŸ¯ è¦†ç›–ç‡æå‡æ–¹æ³•

1. **è¡¥å……ç¼ºå¤±æµ‹è¯•**
   ```typescript
   // ç¤ºä¾‹: è¾¹ç•Œæ¡ä»¶æµ‹è¯•
   describe('è¾¹ç•Œæ¡ä»¶æµ‹è¯•', () => {
     it('åº”è¯¥å¤„ç†ç©ºè¾“å…¥', () => {
       expect(() => parser.parse(null)).not.toThrow();
     });
   });
   ```

2. **å®Œå–„é”™è¯¯å¤„ç†æµ‹è¯•**
   ```typescript
   // ç¤ºä¾‹: å¼‚å¸¸è·¯å¾„æµ‹è¯•  
   it('åº”è¯¥æ­£ç¡®å¤„ç†è¿æ¥å¤±è´¥', async () => {
     mockDevice.connect.mockRejectedValue(new Error('Connection failed'));
     await expect(driver.connect()).rejects.toThrow('Connection failed');
   });
   ```

3. **Mock å¯¹è±¡å®Œå–„**
   ```typescript
   // ç¤ºä¾‹: å®Œæ•´çš„ç¡¬ä»¶è®¾å¤‡ Mock
   const createMockDevice = () => ({
     connect: jest.fn().mockResolvedValue(true),
     disconnect: jest.fn().mockResolvedValue(void 0),
     capture: jest.fn().mockResolvedValue(mockData),
     // ... å®Œæ•´æ¥å£
   });
   ```

### ğŸ” é—®é¢˜å‘ç°ç­–ç•¥

é€šè¿‡æµ‹è¯•å‘ç° src ä»£ç é—®é¢˜çš„æ–¹æ³•ï¼š

1. **ç©ºå€¼å’Œè¾¹ç•Œæ£€æŸ¥**
   - æµ‹è¯• null/undefined è¾“å…¥
   - æµ‹è¯•æ•°ç»„è¾¹ç•Œæ¡ä»¶
   - æµ‹è¯•æ•°å€¼èŒƒå›´é™åˆ¶

2. **å¼‚æ­¥æ“ä½œéªŒè¯**
   - æµ‹è¯• Promise æ­£ç¡®å¤„ç†
   - æµ‹è¯•è¶…æ—¶å’Œé‡è¯•æœºåˆ¶
   - æµ‹è¯•å¹¶å‘æ“ä½œå®‰å…¨æ€§

3. **èµ„æºç®¡ç†éªŒè¯**
   - æµ‹è¯•å†…å­˜æ³„æ¼æ£€æµ‹
   - æµ‹è¯•æ–‡ä»¶å¥æŸ„é‡Šæ”¾
   - æµ‹è¯•ç½‘ç»œè¿æ¥æ¸…ç†

4. **ç±»å‹å®‰å…¨éªŒè¯**
   - æµ‹è¯•ç±»å‹è½¬æ¢æ­£ç¡®æ€§
   - æµ‹è¯•æ¥å£å®ç°å®Œæ•´æ€§
   - æµ‹è¯•æ³›å‹çº¦æŸæœ‰æ•ˆæ€§

---

## ğŸ”§ å®ç”¨å·¥å…·

### ğŸ“ å¸¸ç”¨æµ‹è¯•å‘½ä»¤

```bash
# åŸºç¡€æµ‹è¯•
npm test                              # è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm run test:watch                    # ç›‘è§†æ¨¡å¼
npm run test:coverage                 # è¦†ç›–ç‡æµ‹è¯•

# åˆ†æ¨¡å—æµ‹è¯•
npm run test:drivers                  # æµ‹è¯•é©±åŠ¨æ¨¡å—
npm run test:webview                  # æµ‹è¯•å‰ç«¯æ¨¡å—
npm run test:integration              # é›†æˆæµ‹è¯•

# è°ƒè¯•å’Œè¯Šæ–­
npm run test:debug                    # è°ƒè¯•æ¨¡å¼
npm run test:verbose                  # è¯¦ç»†è¾“å‡º
npm run test:clear                    # æ¸…ç†ç¼“å­˜

# è´¨é‡æ£€æŸ¥
npm run test:lint                     # ä»£ç æ£€æŸ¥
npm run test:type-check               # ç±»å‹æ£€æŸ¥
npm run test:memory                   # å†…å­˜ä½¿ç”¨æ£€æŸ¥
```

### ğŸ› ï¸ è‡ªåŠ¨åŒ–è„šæœ¬

#### æ¯æ—¥è¦†ç›–ç‡æ£€æŸ¥
```bash
#!/bin/bash
# daily-coverage-check.sh
echo "ğŸ“Š æ¯æ—¥è¦†ç›–ç‡æ£€æŸ¥ - $(date +%Y-%m-%d)"
npm run test:coverage -- --silent
echo "ğŸ“ˆ æŠ¥å‘Šå·²ç”Ÿæˆ: coverage/lcov-report/index.html"
```

#### æ¨¡å—ä¸“é¡¹æµ‹è¯•
```bash
#!/bin/bash  
# module-test.sh <module_name> [target_coverage]
MODULE=$1
TARGET=${2:-80}
echo "ğŸ¯ æµ‹è¯•æ¨¡å—: $MODULE (ç›®æ ‡: $TARGET%)"
npm run test:coverage -- --testPathPattern=$MODULE --coverageThreshold="{\"global\":{\"lines\":$TARGET}}"
```

### ğŸ“Š è´¨é‡ç›‘æ§

#### è¦†ç›–ç‡è¶‹åŠ¿è¿½è¸ª
```bash
# æ¯æ¬¡æäº¤åè¿è¡Œ
echo "$(date +%Y-%m-%d),$(npm run test:coverage --silent | grep 'Lines' | awk '{print $4}')" >> coverage-history.csv
```

#### æ€§èƒ½åŸºå‡†æµ‹è¯•
```bash
# æ€§èƒ½å›å½’æ£€æµ‹
npm run test:performance -- --verbose | tee performance-$(date +%Y%m%d).log
```

---

## ğŸ“‹ æ‰§è¡Œæ£€æŸ¥æ¸…å•

### âœ… ç¬¬1å¤©æ£€æŸ¥æ¸…å•
- [ ] è¿è¡Œå¿«é€Ÿä¿®å¤è„šæœ¬
- [ ] éªŒè¯ TypeScript ç¼–è¯‘é€šè¿‡
- [ ] ç¡®è®¤è‡³å°‘50%æµ‹è¯•å¯è¿è¡Œ
- [ ] ç”Ÿæˆåˆæ­¥è¦†ç›–ç‡æŠ¥å‘Š

### âœ… ç¬¬1å‘¨æ£€æŸ¥æ¸…å•  
- [ ] æ ¸å¿ƒæ¨¡å—è¦†ç›–ç‡è¾¾åˆ° 70%+
- [ ] ç®€å•æ¨¡å—è¦†ç›–ç‡è¾¾åˆ° 85%+
- [ ] å»ºç«‹è¦†ç›–ç‡ç›‘æ§æœºåˆ¶
- [ ] å®Œæˆå›¢é˜ŸåŸ¹è®­

### âœ… ç¬¬2-3å‘¨æ£€æŸ¥æ¸…å•
- [ ] æ€»ä½“è¦†ç›–ç‡è¾¾åˆ° 80%+
- [ ] æ‰€æœ‰æ¨¡å—è¦†ç›–ç‡è¾¾æ ‡
- [ ] å»ºç«‹ CI/CD è‡ªåŠ¨åŒ–
- [ ] æ–‡æ¡£æ›´æ–°å®Œæˆ

---

## ğŸ¯ æˆåŠŸæ ‡å‡†

### æŠ€æœ¯æŒ‡æ ‡
- **è¦†ç›–ç‡**: â‰¥ 80% (æ€»ä½“), â‰¥ 85% (æ ¸å¿ƒæ¨¡å—)
- **é€šè¿‡ç‡**: â‰¥ 95%
- **æ‰§è¡Œæ—¶é—´**: â‰¤ 5åˆ†é’Ÿ (å…¨é‡æµ‹è¯•)
- **å†…å­˜ä½¿ç”¨**: â‰¤ 2GB

### è´¨é‡æŒ‡æ ‡
- **TypeScript é”™è¯¯**: 0ä¸ª
- **æµ‹è¯•ç¨³å®šæ€§**: è¿ç»­è¿è¡Œæ— éšæœºå¤±è´¥
- **ä»£ç è´¨é‡**: ESLint æ£€æŸ¥é€šè¿‡
- **æ–‡æ¡£å®Œæ•´æ€§**: 100% API æ–‡æ¡£è¦†ç›–

### æµç¨‹æŒ‡æ ‡
- **è‡ªåŠ¨åŒ–ç¨‹åº¦**: CI/CD å…¨æµç¨‹è‡ªåŠ¨åŒ–
- **å›¢é˜Ÿèƒ½åŠ›**: å…¨å‘˜æŒæ¡æµ‹è¯•ç¼–å†™
- **ç»´æŠ¤æˆæœ¬**: æ–°åŠŸèƒ½æµ‹è¯•å¼€å‘æˆæœ¬ < 20%

---

## ğŸ“ æ”¯æŒä¸è”ç³»

### é—®é¢˜å¤„ç†æµç¨‹
1. æŸ¥çœ‹æœ¬æŒ‡å—å¯¹åº”ç« èŠ‚
2. è¿è¡Œç›¸å…³è¯Šæ–­å‘½ä»¤
3. æŸ¥çœ‹é”™è¯¯æ—¥å¿—è¯¦æƒ…
4. è”ç³»é¡¹ç›®å›¢é˜Ÿ

### å¸¸è§é—®é¢˜è§£å†³
- **æµ‹è¯•è¿è¡Œç¼“æ…¢**: `npm test -- --maxWorkers=2`
- **å†…å­˜æº¢å‡º**: `export NODE_OPTIONS="--max-old-space-size=4096"`
- **è¦†ç›–ç‡å¼‚å¸¸**: `npm run test:clean && npx jest --clearCache`

---

**æ–‡æ¡£ç»´æŠ¤**: æœ¬æ–‡æ¡£æ•´åˆäº†æ‰€æœ‰ç›¸å…³æµ‹è¯•æ–‡æ¡£ï¼Œæ¶ˆé™¤äº†é‡å¤å†…å®¹ï¼ŒåŸºäºå®é™…æ•°æ®æä¾›å‡†ç¡®æŒ‡å¯¼ã€‚  
**æ›´æ–°é¢‘ç‡**: æ¯æ¬¡é‡å¤§æµ‹è¯•æ”¹è¿›åæ›´æ–°  
**ä¸‹æ¬¡è¯„ä¼°**: å®Œæˆç¬¬ä¸€é˜¶æ®µä¿®å¤å
