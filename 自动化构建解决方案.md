# 自动化构建问题解决方案

## 问题描述
每次运行 `./build.sh build` 时，vsce package 命令会提示：
```
WARNING  LICENSE.md, LICENSE.txt or LICENSE not found
Do you want to continue? [y/N]
```
需要手动输入 `y` 才能继续构建。

## 问题原因
vsce 工具在打包扩展时会检查许可证文件，如果没有找到标准命名的许可证文件（如 LICENSE.md 或 LICENSE.txt），会要求用户确认是否继续。

虽然项目中有 `LICENSE` 文件，但 vsce 可能期望特定的文件扩展名。

## 解决方案

### 1. 修改 package.json 中的打包命令
**位置：** `package.json` -> `scripts.package`

**修改前：**
```json
"package": "npm run build:production && vsce package --allow-missing-repository --allow-star-activation --no-dependencies --no-yarn"
```

**修改后：**
```json
"package": "npm run build:production && printf 'y\\n' | vsce package --allow-missing-repository --allow-star-activation --no-dependencies --no-yarn"
```

**说明：** 使用 `printf 'y\\n' |` 管道将自动确认输入传递给 vsce 命令。

### 2. 增强构建脚本中的打包函数
**位置：** `build.sh` -> `package_extension()`

**添加的改进：**
- 设置 `CI=true` 环境变量（某些工具在 CI 环境下会减少交互提示）
- 设置 `NODE_ENV=production` 确保生产模式
- 保持原有的错误处理和文件重命名逻辑

### 3. 使用的 vsce 参数说明
- `--allow-missing-repository`: 允许缺少仓库信息
- `--allow-star-activation`: 允许使用星号激活事件
- `--no-dependencies`: 禁用依赖检测
- `--no-yarn`: 强制使用 npm 而不是 yarn

## 测试结果

✅ **解决方案验证成功**

运行 `./build.sh quick-build` 现在可以完全无人值守地完成构建：

```bash
# 无需手动干预
./build.sh quick-build

# 输出显示自动确认工作正常
WARNING  LICENSE.md, LICENSE.txt or LICENSE not found
Do you want to continue? [y/N] y
✅ DONE  Packaged: vscode-logic-analyzer-1.0.0-beta.0.vsix
```

## 使用建议

1. **日常开发使用：**
   ```bash
   ./build.sh quick-build    # 快速无人值守构建
   ```

2. **发布前检查使用：**
   ```bash
   ./build.sh build         # 完整构建含代码检查
   ```

3. **一键构建安装：**
   ```bash
   ./build.sh build-install # 构建并安装到 VSCode
   ```

## 备选解决方案

如果上述方案在某些环境下仍有问题，可以考虑：

1. **创建 LICENSE.md 符号链接：**
   ```bash
   ln -s LICENSE LICENSE.md
   ```

2. **使用 expect 脚本：**
   ```bash
   expect -c "spawn npm run package; expect 'continue?'; send 'y\r'; interact"
   ```

3. **设置全局 vsce 配置：**
   ```bash
   # 如果 vsce 支持配置文件的话
   echo '{"skipLicenseCheck": true}' > ~/.vsce/config.json
   ```

## 结论

通过在 npm script 中添加管道输入 `printf 'y\\n' |`，成功实现了完全自动化的构建流程，无需任何手动干预。这个解决方案简单、可靠且不影响现有的构建逻辑。
